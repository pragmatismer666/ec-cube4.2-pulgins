# payjp-eccube-4.2-v1

Copyright Subspire Inc. 2020
(https://github.com/payjp/payjp-eccube) のプラグインをベースに、改善とカード情報非通過化対応が含まれています。

[EC-CUBE](http://www.ec-cube.net)用の[PAY.JP](https://pay.jp/)の決済プラグインです。

このプラグインはEC-CUBE上での買い物をPAY.JPで決済する機能を提供します。
決済のみを行うシンプルなプラグインで、受注や集計はEC-CUBEで管理する方針です。
購入者のクレジットカード情報はデータベースに保存せず、ショップのオーナーも見ることはできません。

必要に応じて改造する際には[APIドキュメント](https://pay.jp/docs/api/)をご参照ください。

## 機能

- [PAY.JP](https://pay.jp/)にて簡単な登録を行うことで試せます。
- ゲスト購入の場合は[トークン](https://pay.jp/docs/api/#token-トークン)を利用して一時的に購入します。
- カード情報は PAY.JP のサーバに安全に格納されます。
- カード情報非通過対応済み
- カード保存機能
- 認証のみ・認証と売上処理の決済方法が可能
- EC-CUBE管理画面で支払い請求・払い戻しができる
- EC-CUBE管理画面で手数料を引いた返金及び一部返金ができる
- EC-CUBE管理画面で各注文の PAY.JP 取引詳細リンクを表示
- 他通貨対応
- 3D Secure対応

## 対応環境

- EC-CUBE 4.0.0 以上

## インストール方法

- PAY.JP の公式ライブラリをインストールします。EC-CUBEフォルダで `composer require` を実行してください。

```
php composer.phar require payjp/payjp-php
```

2) プラグインを管理画面からインストールします。

```
2-1) EC-CUBE管理画面の【オーナーズストア】→【プラグイン】→【プラグイン一覧】から
【アップロードして新規追加】のボタンをクリックしていただいて、その後本プラグインのZIPファイルを
選択していただいて、アップロードしていただけます。

2-2) EC-CUBE管理画面の【オーナーズストア】→【プラグイン】→【プラグイン一覧】から
【PAY.JP 決済プラグイン】の【有効にする】をクリックしてください。

2-3) EC-CUBE管理画面の【コンテンツ管理】→【キャッシュ管理】で【キャッシュ削除】を押していただきキャッシュをクリアしてください。

2-4) EC-CUBE管理画面の【PAY.JP管理】→【設定】にてライセンスキーとご購入時にご利用いただいたメールアドレスをご入力ください。
ライセンス認証は1回だけ行えます。先にテスト用でご利用いただく場合は【テスト環境】ボタンを押してください。
テストが完了してテストと本番が同じ環境でしたら一度プラグインをアンインストールしていただき、再度インストールしていただきライセンス認証を行ってください。
また、追加分のライセンスキーが必要でしたら弊社までご連絡ください。1ライセンスにつき一つのEC-CUBE環境でご利用いただけます。

2-5) EC-CUBE管理画面の【PAY.JP管理】→【設定】にてご自身のAPIキーを登録してください。
PAY.JPにてメールアドレスを登録するだけでAPIキーを取得できます。
また、認証のみ・認証と売上処理の決済方法も選択してください。

2-6) EC-CUBE管理画面の【設定】→【店舗設定】→【配送方法設定】から対象になる配送方法で【クレジットカード決済】のチェックを入れて保存してください。

その後、チェックアウトでPAY.JPが利用可能になります。
```

## アップデート方法

旧バージョンからのアップデート方法が下記になります。アップデート時は必ず下記の手順でアップデートをお願いいたします。

1) プラグインを管理画面から更新します。

```
1-1) EC-CUBE管理画面の【オーナーズストア】→【プラグイン】→【プラグイン一覧】からプラグインを無効にします。

1-2) EC-CUBE管理画面の【オーナーズストア】→【プラグイン】→【プラグイン一覧】からプラグインを更新します。

1-3) EC-CUBE管理画面の【オーナーズストア】→【プラグイン】→【プラグイン一覧】からプラグインを有効にします。

1-4) EC-CUBE管理画面の【コンテンツ管理】→【キャッシュ管理】で【キャッシュ削除】を押していただきキャッシュをクリアしてください。
```

## 利用方法

- EC-CUBE管理画面の【設定】→【店舗設定】→【配送方法設定】から対象になる配送方法で【クレジットカード決済】のチェックを入れて保存します。

- 商品を購入する際に、支払方法に「クレジットカード決済」を選択すると、カード情報を入力するフォームが表示されます。

- テスト環境では[テストカード](https://pay.jp/docs/testcard)を利用して試すことが可能です。